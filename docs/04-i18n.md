# Internationalization (i18n)

This project supports German (de) and English (en). Here's how the multi-language system works.

## Overview

```
URL Structure:
/de/           → German homepage
/de/kontakt    → German contact page
/en/           → English homepage
/en/contact    → English contact page
```

Key files:
- `src/i18n/ui.ts` - Translation strings
- `src/i18n/utils.ts` - Helper functions
- `src/i18n/languages.ts` - Language configuration
- `astro.config.mjs` - Astro i18n settings

## How It Works

### 1. URL-Based Language Detection

The language is determined from the URL path:

```
/de/features  →  lang = 'de'
/en/features  →  lang = 'en'
```

### 2. Getting the Current Language

```astro
---
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
// Returns 'de' or 'en'
---
```

### 3. Getting Translations

```astro
---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<h1>{t('page.home.title')}</h1>
<p>{t('page.home.description')}</p>
<a href="#">{t('btn.learnMore')}</a>
```

### 4. Building URLs

```astro
---
import { getLangFromUrl, url } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
---

<!-- Creates: /de/kontakt or /en/contact -->
<a href={url('/contact', lang)}>Contact</a>

<!-- Creates: /de/features or /en/features -->
<a href={url('/features', lang)}>Features</a>
```

## Translation File Structure

### src/i18n/ui.ts

```typescript
export const ui = {
  // German translations
  de: {
    // Navigation
    'nav.home': 'Startseite',
    'nav.features': 'Funktionen',
    'nav.pricing': 'Preise',
    'nav.contact': 'Kontakt',

    // Buttons
    'btn.learnMore': 'Mehr erfahren',
    'btn.getStarted': 'Loslegen',
    'btn.submit': 'Absenden',
    'btn.download': 'Herunterladen',

    // Forms
    'form.name': 'Name',
    'form.email': 'E-Mail',
    'form.message': 'Nachricht',
    'form.required': 'Pflichtfeld',

    // Page-specific
    'page.home.title': 'Willkommen bei VICUS',
    'page.home.description': 'Gebäudesimulation leicht gemacht',

    // Footer
    'footer.copyright': '© {year} VICUS Software. Alle Rechte vorbehalten.',
    'footer.privacy': 'Datenschutz',
    'footer.imprint': 'Impressum',
  },

  // English translations
  en: {
    // Navigation
    'nav.home': 'Home',
    'nav.features': 'Features',
    'nav.pricing': 'Pricing',
    'nav.contact': 'Contact',

    // Buttons
    'btn.learnMore': 'Learn more',
    'btn.getStarted': 'Get started',
    'btn.submit': 'Submit',
    'btn.download': 'Download',

    // Forms
    'form.name': 'Name',
    'form.email': 'Email',
    'form.message': 'Message',
    'form.required': 'Required field',

    // Page-specific
    'page.home.title': 'Welcome to VICUS',
    'page.home.description': 'Building simulation made simple',

    // Footer
    'footer.copyright': '© {year} VICUS Software. All rights reserved.',
    'footer.privacy': 'Privacy Policy',
    'footer.imprint': 'Imprint',
  },
} as const;
```

## Adding New Translations

### Step 1: Add to ui.ts

Add your new key to BOTH languages:

```typescript
export const ui = {
  de: {
    // ... existing keys
    'page.newFeature.title': 'Neue Funktion',
    'page.newFeature.description': 'Dies ist eine neue Funktion.',
  },
  en: {
    // ... existing keys
    'page.newFeature.title': 'New Feature',
    'page.newFeature.description': 'This is a new feature.',
  },
} as const;
```

### Step 2: Use in Components

```astro
---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<h1>{t('page.newFeature.title')}</h1>
<p>{t('page.newFeature.description')}</p>
```

## Translation with Parameters

For dynamic values in translations, use placeholder syntax:

```typescript
// In ui.ts
de: {
  'greeting': 'Hallo, {name}!',
  'items.count': '{count} Artikel gefunden',
},
en: {
  'greeting': 'Hello, {name}!',
  'items.count': '{count} items found',
},
```

```astro
---
const t = useTranslations(lang);
---

<p>{t('greeting', { name: 'Max' })}</p>
<!-- Output: "Hallo, Max!" or "Hello, Max!" -->

<p>{t('items.count', { count: 5 })}</p>
<!-- Output: "5 Artikel gefunden" or "5 items found" -->
```

## Route Mapping

Some routes have different names in each language. These are defined in `utils.ts`:

```typescript
const routeTranslations: Record<string, Record<string, string>> = {
  de: {
    'contact': 'kontakt',
    'careers': 'karriere',
    'privacy': 'datenschutz',
    'imprint': 'impressum',
    'documentation': 'dokumentation',
  },
  en: {
    'kontakt': 'contact',
    'karriere': 'careers',
    'datenschutz': 'privacy',
    'impressum': 'imprint',
    'dokumentation': 'documentation',
  },
};
```

The `url()` function automatically handles these translations:

```astro
---
const lang = getLangFromUrl(Astro.url);  // 'de'
---

<a href={url('/contact', lang)}>
  <!-- Outputs: /de/kontakt -->
</a>
```

## Creating Bilingual Pages

For every page, create files in both language folders:

```
src/pages/
├── de/
│   ├── index.astro          # German homepage
│   ├── kontakt.astro        # German contact (note: German URL)
│   └── funktionen.astro     # German features
└── en/
    ├── index.astro          # English homepage
    ├── contact.astro        # English contact
    └── features.astro       # English features
```

### Page Template

```astro
---
// src/pages/de/kontakt.astro (or src/pages/en/contact.astro)
import PageLayout from '../../layouts/PageLayout.astro';
import ContactForm from '../../components/ContactForm.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<PageLayout
  title={t('page.contact.title')}
  description={t('page.contact.description')}
>
  <section class="section">
    <div class="container-custom">
      <h1>{t('page.contact.heading')}</h1>
      <ContactForm />
    </div>
  </section>
</PageLayout>
```

## Language Switcher

The `LanguageSwitcher.astro` component lets users switch languages:

```astro
---
import { getLangFromUrl, getTranslatedPath } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname;

// Get the equivalent path in the other language
const dePath = getTranslatedPath(currentPath, 'de');
const enPath = getTranslatedPath(currentPath, 'en');
---

<div class="flex gap-2">
  <a
    href={dePath}
    class:list={[
      'px-2 py-1 rounded',
      lang === 'de' ? 'bg-primary text-secondary' : 'text-gray-400'
    ]}
  >
    DE
  </a>
  <a
    href={enPath}
    class:list={[
      'px-2 py-1 rounded',
      lang === 'en' ? 'bg-primary text-secondary' : 'text-gray-400'
    ]}
  >
    EN
  </a>
</div>
```

## Astro i18n Configuration

In `astro.config.mjs`:

```javascript
export default defineConfig({
  i18n: {
    defaultLocale: 'de',
    locales: ['de', 'en'],
    routing: {
      prefixDefaultLocale: true,  // Use /de/ prefix even for German
    }
  },
});
```

### Why prefix the default locale?

With `prefixDefaultLocale: true`:
- `/de/kontakt` → German contact
- `/en/contact` → English contact

Without it (if `false`):
- `/kontakt` → German contact (no prefix)
- `/en/contact` → English contact

We use `true` for consistency and clearer URL structure.

## Translation Naming Conventions

Use a consistent naming scheme:

```typescript
{
  // Navigation: nav.*
  'nav.home': '...',
  'nav.about': '...',

  // Buttons: btn.*
  'btn.submit': '...',
  'btn.cancel': '...',

  // Forms: form.*
  'form.name': '...',
  'form.email': '...',

  // Pages: page.<pageName>.*
  'page.home.title': '...',
  'page.home.hero': '...',
  'page.contact.title': '...',

  // Products: <product>.*
  'buildings.title': '...',
  'buildings.features': '...',
  'districts.title': '...',

  // Common: misc.* or common.*
  'misc.loading': '...',
  'misc.error': '...',

  // Footer: footer.*
  'footer.copyright': '...',
  'footer.links': '...',
}
```

## Common Patterns

### Translated Links with Icons

```astro
---
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<a href={url('/features', lang)} class="flex items-center gap-2">
  <svg>...</svg>
  <span>{t('nav.features')}</span>
</a>
```

### Conditional Content by Language

```astro
---
const lang = getLangFromUrl(Astro.url);
---

{lang === 'de' ? (
  <p>German-specific content or legal notice</p>
) : (
  <p>English-specific content</p>
)}
```

### Date Formatting

```astro
---
const lang = getLangFromUrl(Astro.url);
const date = new Date('2024-01-15');

const formattedDate = date.toLocaleDateString(
  lang === 'de' ? 'de-DE' : 'en-US',
  { year: 'numeric', month: 'long', day: 'numeric' }
);
// German: "15. Januar 2024"
// English: "January 15, 2024"
---

<time datetime="2024-01-15">{formattedDate}</time>
```

### Number Formatting

```astro
---
const lang = getLangFromUrl(Astro.url);
const price = 1234.56;

const formattedPrice = price.toLocaleString(
  lang === 'de' ? 'de-DE' : 'en-US',
  { style: 'currency', currency: 'EUR' }
);
// German: "1.234,56 €"
// English: "€1,234.56"
---

<span>{formattedPrice}</span>
```

## Troubleshooting

### Translation key not found

If you see the raw key instead of translated text:

1. Check spelling of the key in ui.ts
2. Make sure the key exists in BOTH languages
3. Verify you're using `t('key')` not just `'key'`

### Wrong language showing

1. Check the URL path starts with `/de/` or `/en/`
2. Verify `getLangFromUrl()` is being called correctly
3. Check you're passing `lang` to `useTranslations(lang)`

### Links going to wrong language

1. Always use `url('/path', lang)` instead of hardcoded paths
2. Check route mappings in `utils.ts` if using translated URLs

## Next Steps

- [Quick Reference](./05-quick-reference.md) - Cheat sheet for common tasks
- [Components](./03-components.md) - See how components use i18n
