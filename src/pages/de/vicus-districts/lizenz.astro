---
import PageLayout from '../../../layouts/PageLayout.astro';
import SubNavigation from '../../../components/SubNavigation.astro';
import Testimonial from '../../../components/Testimonial.astro';
import { useTranslations, url } from '../../../i18n/utils';

const lang = 'de';
const t = useTranslations(lang);

const subNavItems = [
  { label: t('districts.overview'), href: url(`/${lang}/vicus-districts`) },
  { label: t('districts.features'), href: url(`/${lang}/vicus-districts/funktionen`) },
  { label: t('districts.license'), href: url(`/${lang}/vicus-districts/lizenz`) },
  { label: t('districts.onboarding'), href: url(`/${lang}/vicus-districts/onboarding`) },
  { label: t('districts.comparison'), href: url(`/${lang}/vicus-districts/vergleich`) },
  { label: t('districts.faq'), href: url(`/${lang}/vicus-districts/faq`) },
];

// Dynamic pricing tiers
const dynamicTiers = [
  {
    name: 'Districts Dynamic Basic',
    price: '242€',
    period: 'Monat',
    description: 'Kalte Nahwärme oder kleine konventionelle Nahwärmenetze',
    maxConsumers: 'Bis 100',
    cta: 'Lizenzanfrage stellen',
    ctaHref: url(`/${lang}/kontakt`),
  },
  {
    name: 'Districts Dynamic Advanced',
    price: '408€',
    period: 'Monat',
    description: 'Mittelgroße Nahwärmenetze',
    maxConsumers: 'Bis 300',
    highlighted: true,
    cta: 'Lizenzanfrage stellen',
    ctaHref: url(`/${lang}/kontakt`),
  },
  {
    name: 'Districts Dynamic Pro',
    price: '575€',
    period: 'Monat',
    description: 'Fernwärmenetze',
    maxConsumers: 'Bis 1.000 **',
    cta: 'Lizenzanfrage stellen',
    ctaHref: url(`/${lang}/kontakt`),
  },
];

// Static pricing tiers
const staticTiers = [
  {
    name: 'Districts Static Basic',
    price: '125€',
    period: 'Monat',
    description: 'Kalte Nahwärme oder kleine konventionelle Nahwärmenetze',
    maxConsumers: 'Bis 100',
    cta: 'Lizenzanfrage stellen',
    ctaHref: url(`/${lang}/kontakt`),
  },
  {
    name: 'Districts Static Advanced',
    price: 'coming soon',
    period: '',
    description: 'Mittelgroße Nahwärmenetze',
    maxConsumers: 'Bis 300',
    highlighted: true,
    cta: 'Kontakt aufnehmen',
    ctaHref: url(`/${lang}/kontakt`),
  },
  {
    name: 'Districts Static Pro',
    price: 'coming soon',
    period: '',
    description: 'Fernwärmenetze',
    maxConsumers: 'Bis 1.000 **',
    cta: 'Kontakt aufnehmen',
    ctaHref: url(`/${lang}/kontakt`),
  },
];

// Feature comparison for Dynamic
const dynamicFeatures = [
  { feature: 'Import und Export von GIS, PDF, DXF', values: [true, true, true] },
  { feature: 'Einfache Netzplanung und -dimensionierung', values: [true, true, true] },
  { feature: 'Stationäre Druckverlustberechnung', values: [true, true, true] },
  { feature: 'Mehrere Energiezentralen / Wärmequellen', values: [false, true, true] },
  { feature: 'Thermo-hydraulische Simulation', values: [true, true, true] },
  { feature: 'Wärmeverluste / -gewinne bestimmen', values: [true, true, true] },
  { feature: 'Dimensionierung von geothermischen Quellen für kalte Nahwärme', values: [true, true, true] },
  { feature: '3 Stunden Onboarding mit unserem Expertenteam', values: [false, 'ja *', 'ja *'] },
  { feature: 'Maximale Anzahl Abnehmer', values: ['Bis 100', 'Bis 300', 'Bis 1.000 **'] },
  { feature: 'Preis', values: ['242€/Monat', '408€/Monat', '575€/Monat'] },
];

// Feature comparison for Static
const staticFeatures = [
  { feature: 'Import und Export von GIS, PDF, DXF', values: [true, true, true] },
  { feature: 'Einfache Netzplanung und -dimensionierung', values: [true, true, true] },
  { feature: 'Stationäre Druckverlustberechnung', values: [true, true, true] },
  { feature: 'Mehrere Energiezentralen / Wärmequellen', values: [false, true, true] },
  { feature: 'Thermo-hydraulische Simulation', values: [false, false, false] },
  { feature: 'Wärmeverluste / -gewinne bestimmen', values: [false, false, false] },
  { feature: 'Dimensionierung von geothermischen Quellen für kalte Nahwärme', values: [false, false, false] },
  { feature: '3 Stunden Onboarding mit unserem Expertenteam', values: [false, 'ja *', 'ja *'] },
  { feature: 'Maximale Anzahl Abnehmer', values: ['Bis 100', 'Bis 300', 'Bis 1.000 **'] },
  { feature: 'Preis', values: ['125€/Monat', 'coming soon', 'coming soon'] },
];
---

<PageLayout
  title="Preise & Lizenzen | VICUS DISTRICTS"
  description="Flexible Lizenzmodelle für VICUS DISTRICTS. Von kleinen Projekten bis zu großen Fernwärmenetzen."
  showHero={false}
>
  <!-- Header -->
  <section class="pt-32 pb-8">
    <div class="container-custom">
      <h1 class="text-3xl md:text-4xl font-bold text-foreground mb-4">Preise & Lizenzen</h1>
      <p class="text-xl text-foreground/70 max-w-3xl">
        Flexible Lizenzmodelle für jede Projektgröße. Alle Lizenzen beinhalten die vollständige Software und regelmäßige Updates.
      </p>
    </div>
  </section>

  <SubNavigation items={subNavItems} currentPath={Astro.url.pathname} />

  <!-- License Type Tabs -->
  <section class="section">
    <div class="container-custom">
      <!-- Tab Buttons -->
      <div class="flex justify-center mb-12">
        <div class="inline-flex rounded-lg border border-foreground/20 p-1 bg-secondary/30">
          <button
            id="tab-dynamic"
            class="license-tab px-6 py-3 rounded-md font-medium transition-all bg-primary text-background"
            data-tab="dynamic"
          >
            Dynamische Simulation
          </button>
          <button
            id="tab-static"
            class="license-tab px-6 py-3 rounded-md font-medium transition-all text-foreground/70 hover:text-foreground"
            data-tab="static"
          >
            Stationäre Berechnung
          </button>
        </div>
      </div>

      <!-- Dynamic Pricing Content -->
      <div id="content-dynamic" class="license-content">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-semibold text-foreground mb-2">Districts Dynamic</h2>
          <p class="text-foreground/70">Mit thermo-hydraulischer Jahressimulation</p>
        </div>

        <!-- Feature Comparison Table -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse max-w-5xl mx-auto">
            <thead>
              <tr>
                <th class="text-left p-4 bg-secondary/50 border-b border-foreground/10 rounded-tl-lg">
                  <span class="text-foreground font-semibold">Funktionen</span>
                </th>
                <th class="text-center p-4 bg-secondary/50 border-b border-foreground/10">
                  <div class="text-foreground font-semibold">Districts Dynamic</div>
                  <div class="text-primary text-sm">Basic</div>
                </th>
                <th class="text-center p-4 bg-secondary/50 border-b border-foreground/10">
                  <div class="text-foreground font-semibold">Districts Dynamic</div>
                  <div class="text-primary text-sm">Advanced</div>
                </th>
                <th class="text-center p-4 bg-secondary/50 border-b border-foreground/10 rounded-tr-lg">
                  <div class="text-foreground font-semibold">Districts Dynamic</div>
                  <div class="text-primary text-sm">Pro</div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr class="bg-secondary/20">
                <td class="p-4 border-b border-foreground/5">
                  <span class="text-foreground/80">Typische Anwendung</span>
                </td>
                <td class="text-center p-4 border-b border-foreground/5 text-sm text-foreground/70">
                  Kalte Nahwärme oder kleine konventionelle Nahwärmenetze
                </td>
                <td class="text-center p-4 border-b border-foreground/5 text-sm text-foreground/70">
                  Mittelgroße Nahwärmenetze
                </td>
                <td class="text-center p-4 border-b border-foreground/5 text-sm text-foreground/70">
                  Fernwärmenetze
                </td>
              </tr>
              {dynamicFeatures.map((item, rowIndex) => (
                <tr class:list={[rowIndex % 2 === 0 ? "bg-background" : "bg-secondary/20"]}>
                  <td class="p-4 border-b border-foreground/5">
                    <span class="text-foreground/80">{item.feature}</span>
                  </td>
                  {item.values.map((value) => (
                    <td class="text-center p-4 border-b border-foreground/5">
                      {typeof value === 'boolean' ? (
                        value ? (
                          <svg class="w-6 h-6 text-primary mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                          </svg>
                        ) : (
                          <svg class="w-6 h-6 text-red-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        )
                      ) : (
                        <span class:list={[
                          "text-foreground/80",
                          item.feature === 'Preis' && "font-semibold text-foreground"
                        ]}>{value}</span>
                      )}
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <div class="mt-6 text-sm text-foreground/50 max-w-5xl mx-auto">
          <p>* Das Onboarding Angebot gilt bei Erwerb einer Jahreslizenz.</p>
          <p>** Für größere Netze erstellen wir ein individuelles Angebot.</p>
        </div>

        <div class="mt-8 text-center">
          <a href={url(`/${lang}/kontakt`)} class="btn btn-primary">
            Lizenzanfrage stellen
          </a>
        </div>
      </div>

      <!-- Static Pricing Content -->
      <div id="content-static" class="license-content hidden">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-semibold text-foreground mb-2">Districts Static</h2>
          <p class="text-foreground/70">Mit stationärer Berechnung (ohne dynamische Simulation)</p>
        </div>

        <!-- Feature Comparison Table -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse max-w-5xl mx-auto">
            <thead>
              <tr>
                <th class="text-left p-4 bg-secondary/50 border-b border-foreground/10 rounded-tl-lg">
                  <span class="text-foreground font-semibold">Funktionen</span>
                </th>
                <th class="text-center p-4 bg-secondary/50 border-b border-foreground/10">
                  <div class="text-foreground font-semibold">Districts Static</div>
                  <div class="text-primary text-sm">Basic</div>
                </th>
                <th class="text-center p-4 bg-secondary/50 border-b border-foreground/10">
                  <div class="text-foreground font-semibold">Districts Static</div>
                  <div class="text-primary text-sm">Advanced</div>
                </th>
                <th class="text-center p-4 bg-secondary/50 border-b border-foreground/10 rounded-tr-lg">
                  <div class="text-foreground font-semibold">Districts Static</div>
                  <div class="text-primary text-sm">Pro</div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr class="bg-secondary/20">
                <td class="p-4 border-b border-foreground/5">
                  <span class="text-foreground/80">Typische Anwendung</span>
                </td>
                <td class="text-center p-4 border-b border-foreground/5 text-sm text-foreground/70">
                  Kalte Nahwärme oder kleine konventionelle Nahwärmenetze
                </td>
                <td class="text-center p-4 border-b border-foreground/5 text-sm text-foreground/70">
                  Mittelgroße Nahwärmenetze
                </td>
                <td class="text-center p-4 border-b border-foreground/5 text-sm text-foreground/70">
                  Fernwärmenetze
                </td>
              </tr>
              {staticFeatures.map((item, rowIndex) => (
                <tr class:list={[rowIndex % 2 === 0 ? "bg-background" : "bg-secondary/20"]}>
                  <td class="p-4 border-b border-foreground/5">
                    <span class="text-foreground/80">{item.feature}</span>
                  </td>
                  {item.values.map((value) => (
                    <td class="text-center p-4 border-b border-foreground/5">
                      {typeof value === 'boolean' ? (
                        value ? (
                          <svg class="w-6 h-6 text-primary mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                          </svg>
                        ) : (
                          <svg class="w-6 h-6 text-red-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        )
                      ) : (
                        <span class:list={[
                          "text-foreground/80",
                          item.feature === 'Preis' && "font-semibold text-foreground",
                          value === 'coming soon' && "italic text-foreground/50"
                        ]}>{value}</span>
                      )}
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <div class="mt-6 text-sm text-foreground/50 max-w-5xl mx-auto">
          <p>* Das Onboarding Angebot gilt bei Erwerb einer Jahreslizenz.</p>
          <p>** Für größere Netze erstellen wir ein individuelles Angebot.</p>
        </div>

        <div class="mt-8 text-center">
          <a href={url(`/${lang}/kontakt`)} class="btn btn-primary">
            Lizenzanfrage stellen
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Academic License -->
  <section class="section bg-secondary/30">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto">
        <div class="card bg-primary/10 border-primary/30">
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-primary/20 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
              </svg>
            </div>
            <div>
              <h3 class="text-xl font-semibold text-foreground mb-2">Kostenlose Lizenzen für Bildung & Forschung</h3>
              <p class="text-foreground/70 mb-4">
                Für Studierende, Lehrende und Forschungseinrichtungen stellen wir kostenlose Lizenzen zur Verfügung.
                Ideal für Lehrveranstaltungen, Abschlussarbeiten und Forschungsprojekte.
              </p>
              <a href={url(`/${lang}/kontakt`)} class="btn btn-primary">
                Bildungslizenz anfragen
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonial -->
  <section class="section">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto">
        <Testimonial
          quote="VICUS DISTRICTS hat unsere Projektabwicklung erheblich beschleunigt. Die intuitive Bedienung und die präzisen Simulationsergebnisse überzeugen uns täglich aufs Neue."
          author="Dr. Thomas Müller"
          role="Projektleiter"
          company="Stadtwerke Meiningen"
        />
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="section bg-secondary/30">
    <div class="container-custom text-center">
      <h2 class="text-foreground mb-4">Noch Fragen?</h2>
      <p class="text-xl text-foreground/70 max-w-2xl mx-auto mb-8">
        Unser Vertriebsteam berät Sie gerne zu den verschiedenen Lizenzoptionen.
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        <a href={url(`/${lang}/kontakt`)} class="btn btn-primary">
          {t('btn.contact')}
        </a>
        <a href={url(`/${lang}/vicus-districts/onboarding`)} class="btn btn-secondary">
          {t('districts.testLicense')}
        </a>
      </div>
    </div>
  </section>
</PageLayout>

<script>
  const tabs = document.querySelectorAll('.license-tab');
  const contents = document.querySelectorAll('.license-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetTab = tab.getAttribute('data-tab');

      // Update tab styles
      tabs.forEach(t => {
        if (t.getAttribute('data-tab') === targetTab) {
          t.classList.add('bg-primary', 'text-background');
          t.classList.remove('text-foreground/70', 'hover:text-foreground');
        } else {
          t.classList.remove('bg-primary', 'text-background');
          t.classList.add('text-foreground/70', 'hover:text-foreground');
        }
      });

      // Update content visibility
      contents.forEach(content => {
        if (content.id === `content-${targetTab}`) {
          content.classList.remove('hidden');
        } else {
          content.classList.add('hidden');
        }
      });
    });
  });
</script>
